<!DOCTYPE html>
<html>
<head>
    <title>Chess Room</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>

<h3>Chess Room</h3>
<input id="roomLink" readonly>

<div id="container" style="display:none;">
    <div id="board"></div>

    <div id="chat">
        <ul id="messages"></ul>
        <input id="msg" placeholder="Message">
        <button onclick="sendMessage()">Send</button>
    </div>
</div>

<script src="/socket.io/socket.io.js"></script>

<script>
const socket = io();
const roomId = location.pathname.split("/")[2];
const params = new URLSearchParams(window.location.search);
const code = params.get("code");

if (!code) {
    alert("Verification code required");
    window.location.href = "/";
}

socket.emit("verifyAndJoin", { roomId, code });

socket.on("verificationSuccess", () => {
    document.getElementById("roomLink").value = location.href;
    document.getElementById("container").style.display = "flex";

    // load game only after verification
    const script = document.createElement("script");
    script.src = "/game.js";
    document.body.appendChild(script);
});

socket.on("verificationFailed", msg => {
    alert(msg);
    window.location.href = "/";
});
</script>

</body>
</html>
