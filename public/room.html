<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

const roomId = window.location.pathname.split("/")[2];
const params = new URLSearchParams(window.location.search);
const code = params.get("code");

if (!code) {
    alert("Verification code required");
    window.location.href = "/";
}

socket.emit("verifyAndJoin", { roomId, code });

socket.on("verificationSuccess", () => {
    startChess(); // load chess after auth
});

socket.on("verificationFailed", (msg) => {
    alert(msg);
    window.location.href = "/";
});

function startChess(){
    const script = document.createElement("script");
    script.src = "/game.js";
    document.body.appendChild(script);
}
</script>
