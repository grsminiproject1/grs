<!DOCTYPE html>
<html>
<head>
    <title>Chess Room</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>

<h3>Chess Room</h3>

<div id="container">
    <div id="board"></div>

    <div id="chat">
        <ul id="messages"></ul>
        <input id="msg" placeholder="Message">
        <button onclick="sendMessage()">Send</button>
    </div>
</div>

<script src="/socket.io/socket.io.js"></script>

<script>
/* ===== SINGLE SOCKET ===== */
window.socket = io();

const roomId = window.location.pathname.split("/")[2];
const urlParams = new URLSearchParams(window.location.search);
const code = urlParams.get("code");

if (!code) {
    alert("Verification code required");
    window.location.href = "/";
}

/* verify first */
socket.emit("verifyAndJoin", { roomId, code });

socket.on("verificationFailed", msg=>{
    alert(msg);
    window.location.href="/";
});

socket.on("verificationSuccess", ()=>{
    console.log("Joined room");
});
</script>

<script src="/game.js"></script>

</body>
</html>
